---
title: Workplace Wage by City
output: 
    github_document:
        toc: true
---

```{R, warning=FALSE, results='hide', message=FALSE}
library(knitr)
library(readxl)
library(stargazer)
library(lmtest)
library(data.table)
```

# Import Data

```{R, warning=FALSE, results='hide', message=FALSE}
rawGraduate <- read_excel("109cityu.xls")
rawWage <- read_excel("workplaceWageCity.xlsx")
rawWorkforce <- read_excel("cityWorkforce.xlsx")
```

```{R}
CITY <- cbind(rawWage["...1"], rawWage["109"], rawWage["108"], rawWage["107"], rawGraduate$...10[5:24])
colnames(CITY) <- c("city", "wage2020", "wage2019", "wage2018", "graduate2020")
CITY$graduate2020 <- as.numeric(CITY$graduate2020)
direct <- seq(0, 0, length.out = 20)
direct[1:6] <- 1
CITY <- cbind(CITY, direct)
rm(direct)
```

## Workforce Data

```{R, echo=FALSE, results='hide'}
workforceTranspose <- function(name, start, end) {
    year <- 2010
    for(n in start:end){
        CITY <- cbind(CITY, transpose(rawWorkforce[n, 4:23]))
        colnames(CITY)[ncol(CITY)] <- paste(name, year)
        year <- year + 1
    }
    return(CITY)
}

CITY <- workforceTranspose("workforceCollege", 3, 14)
CITY <- workforceTranspose("workforceYoung", 16, 27)
CITY <- workforceTranspose("workforceMiddle", 29, 40)
CITY <- workforceTranspose("workforceOld", 42, 53)
CITY <- workforceTranspose("workforceRetired", 55, 66)
```

# SLR
```{R, results='hold'}
slr <- lm(CITY$wage109 ~ CITY$graduate109, )
summary(slr)
#stargazer(slr)
```

```{R}
plot(CITY$graduate109, CITY$wage109, main="2020 City Data", xlab="No. of Graduate", ylab="Average yearly wage ($10,000)")
text(CITY$graduate109[c(8,19)], CITY$wage109[c(8,19)], labels = c("Hsinchu County", "Hsinchu City"), cex = 0.6, pos = 4)
abline(slr)
```

# MLR

# Heteroskedaticity

## Test
We use the White Test for heteroskedaticity by specifying a formula with interaction term and sqaure term to the BP Test.
```{R}
bptest(slr, ~ CITY$graduate109 + I(CITY$graduate109^2))
```
Heteroskedaticity doesn't seem present.

## Robust